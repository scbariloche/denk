package com.example.andenk.schichtln.helper

import android.content.ContentValues
import android.content.Context
import android.database.Cursor
import android.database.sqlite.SQLiteDatabase
import android.database.sqlite.SQLiteOpenHelper
import com.example.andenk.schichtln.pojos.User

/**
 * Created by andreas on 29.12.2017.
 */
class DBHelper(context: Context) : SQLiteOpenHelper(context, "DB", null, 1) {

    val USER_TABLE = "user"

    override fun onCreate(db: SQLiteDatabase) {
        db.execSQL(
                "create table  if not exists " + USER_TABLE + " " +
                        "(id integer primary key, u_id interger, nickname text, username text,tel text, admin integer)"
        )
    }

    override fun onUpgrade(db: SQLiteDatabase, p1: Int, p2: Int) {
        onCreate(db)
    }

    fun setUser(user: User): Long {
        val contentValues = ContentValues()
        contentValues.put("id", 1)
        contentValues.put("u_id", user.id)
        contentValues.put("nickname", user.nickname)
        contentValues.put("username", user.username)
        contentValues.put("tel", user.tel)
        contentValues.put("admin",user.admin)
        return writableDatabase.replace(USER_TABLE, null, contentValues)
    }

    fun deleteCurrentUser(): Int {

        var id = arrayOf("1")

        return delete(USER_TABLE, "id", id)
    }

    fun delete(tableName: String, column: String, ids: Array<String>): Int {
        val db = this.writableDatabase
        return db.delete(
                tableName,
                column + " = ?",
                ids)
    }

    fun getCurrentUser(): User? {
        var user = User()
        val db = readableDatabase
        var res: Cursor? = null
        try {
            res = db.rawQuery("select * from " + USER_TABLE + " where id= 1", null)
            if (res!!.moveToFirst()) {
                user.id = res.getInt(res.getColumnIndex("u_id"))
                user.nickname = res.getString(res.getColumnIndex("nickname"))
                user.username = res.getString(res.getColumnIndex("username"))
                user.tel = res.getString(res.getColumnIndex("tel"))
                user.admin =res.getInt(res.getColumnIndex("admin"))==1
            } else {
                return null
            }
        } finally {
            if (res != null)
                res.close()
        }
        return user
    }
}